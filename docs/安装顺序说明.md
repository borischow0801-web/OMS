# 系统安装顺序说明

本文档说明系统的安装顺序，帮助您按步骤完成系统部署。

## 安装顺序概览

1. **系统环境准备** → 2. **数据库配置** → 3. **后端部署** → 4. **前端PC端部署** → 5. **微信小程序配置**

## 详细安装步骤

### 第一步：系统环境准备

**目标**: 安装所有必需的系统软件和工具

**执行顺序**:
1. 更新系统包
2. 安装基础工具（git, curl, wget, build-essential）
3. 安装 Python 3.10+
4. 安装 Node.js 18+
5. 安装 MySQL 8.0+
6. 安装 Redis 6.0+
7. 安装 Nginx（可选，生产环境需要）

**验证**: 
- `python3 --version` 应显示 Python 3.10+
- `node --version` 应显示 v18+
- `mysql --version` 应显示 MySQL 8.0+
- `redis-cli ping` 应返回 PONG

**预计时间**: 30-60分钟

---

### 第二步：数据库配置

**目标**: 创建数据库和用户，配置数据库连接

**执行顺序**:
1. 启动 MySQL 服务
2. 创建数据库 `oms_db`
3. 创建数据库用户 `oms_user`
4. 授予用户权限
5. 验证数据库连接

**验证**: 
- `mysql -u oms_user -p oms_db` 应能成功连接

**预计时间**: 5-10分钟

---

### 第三步：后端部署

**目标**: 部署 Django 后端服务

**执行顺序**:
1. 进入 `backend` 目录
2. 创建 Python 虚拟环境
3. 激活虚拟环境
4. 安装 Python 依赖 (`pip install -r requirements.txt`)
5. 复制 `.env.example` 为 `.env`
6. 编辑 `.env` 文件，配置数据库连接等信息
7. 执行数据库迁移 (`python manage.py migrate`)
8. 创建超级管理员 (`python manage.py createsuperuser`)
9. 收集静态文件 (`python manage.py collectstatic`)
10. 测试运行 (`python manage.py runserver`)

**验证**: 
- 访问 http://localhost:8000/admin 应能看到登录页面
- 使用超级管理员账号登录成功

**预计时间**: 15-20分钟

**注意事项**:
- 确保 MySQL 服务正在运行
- 确保 `.env` 文件中的数据库配置正确
- 如果遇到 `mysqlclient` 安装问题，可能需要先安装系统依赖：
  ```bash
  sudo apt install -y default-libmysqlclient-dev build-essential
  ```

---

### 第四步：前端PC端部署

**目标**: 部署 React 前端应用

**执行顺序**:
1. 进入 `frontend-pc` 目录
2. 安装 Node.js 依赖 (`npm install`)
3. 复制 `.env.example` 为 `.env.local`
4. 编辑 `.env.local` 文件，配置 API 地址
5. 测试运行 (`npm run dev`)

**验证**: 
- 访问 http://localhost:3000 应能看到登录页面
- 使用后端创建的账号登录成功

**预计时间**: 10-15分钟

**注意事项**:
- 确保后端服务正在运行（端口 8000）
- 确保 `.env.local` 中的 `VITE_API_BASE_URL` 指向正确的后端地址
- 如果遇到端口占用，可以修改 `vite.config.js` 中的端口配置

---

### 第五步：微信小程序配置

**目标**: 配置微信小程序开发环境

**执行顺序**:
1. 安装微信开发者工具
2. 打开微信开发者工具
3. 导入项目，选择 `frontend-miniprogram` 目录
4. 配置 AppID（测试可以使用测试号）
5. 编辑 `utils/config.js`，配置 API 地址
6. 在微信公众平台配置服务器域名（生产环境）

**验证**: 
- 在微信开发者工具中能正常预览小程序
- API 请求能正常发送和接收

**预计时间**: 10-15分钟

**注意事项**:
- 开发环境可以关闭域名校验
- 生产环境需要在微信公众平台配置合法域名
- API 地址需要支持 HTTPS（生产环境）

---

## 快速验证清单

完成所有步骤后，使用以下清单验证系统是否正常运行：

- [ ] 后端服务运行正常（http://localhost:8000/admin）
- [ ] 前端PC端运行正常（http://localhost:3000）
- [ ] 可以成功登录系统
- [ ] 可以创建任务（使用方角色）
- [ ] 可以审核任务（管理方角色）
- [ ] 可以指派任务（项目经理角色）
- [ ] 可以处理任务（员工角色）
- [ ] 微信小程序可以正常预览

## 常见问题处理

### 问题1: MySQL 连接失败
- 检查 MySQL 服务是否运行: `sudo systemctl status mysql`
- 检查 `.env` 文件中的数据库配置
- 检查数据库用户权限

### 问题2: Python 依赖安装失败
- 确保已安装系统依赖: `sudo apt install -y default-libmysqlclient-dev build-essential`
- 尝试升级 pip: `pip install --upgrade pip`
- 检查 Python 版本是否符合要求

### 问题3: 前端无法连接后端
- 检查后端服务是否运行
- 检查 `.env.local` 中的 API 地址配置
- 检查 CORS 配置（后端 `settings.py`）

### 问题4: 端口被占用
- 后端: 修改 `manage.py runserver` 的端口参数
- 前端: 修改 `vite.config.js` 中的端口配置

## 下一步

完成基础安装后，您可以：
1. 创建测试用户（不同角色）
2. 测试完整的工作流程
3. 配置生产环境部署（参考 `部署说明.md`）
4. 根据实际需求调整配置

