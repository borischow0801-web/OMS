# 信息化软件项目运维管理系统 - 部署说明

## 系统要求

### 服务器环境
- **操作系统**: Ubuntu 24.04 LTS
- **Python**: 3.10 或更高版本
- **Node.js**: 18.x 或更高版本
- **MySQL**: 8.0 或更高版本
- **Redis**: 6.0 或更高版本
- **Nginx**: 1.18 或更高版本

### 开发环境
- **微信开发者工具**: 最新版本（用于小程序开发）

## 部署步骤

### 第一步：系统环境准备

#### 1.1 更新系统包
```bash
sudo apt update && sudo apt upgrade -y
```

#### 1.2 安装基础工具
```bash
sudo apt install -y git curl wget build-essential
```

#### 1.2.1 安装 Python 依赖编译所需的系统库
```bash
# 安装 MySQL 客户端开发库（mysqlclient 包需要）
sudo apt install -y default-libmysqlclient-dev pkg-config
# 或使用以下命令（Ubuntu 24.04 推荐）
sudo apt install -y libmysqlclient-dev pkg-config
```

#### 1.3 安装 Python 3.10+
```bash
sudo apt install -y python3 python3-pip python3-venv python3-dev
python3 --version  # 验证版本
```

#### 1.4 安装 Node.js 18+
```bash
# 使用 NodeSource 仓库安装
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt install -y nodejs
node --version  # 验证版本
npm --version   # 验证版本
```

#### 1.5 安装 MySQL
```bash
sudo apt install -y mysql-server
sudo mysql_secure_installation
# 设置root密码，并按照提示完成安全配置
```

#### 1.6 安装 Redis
```bash
sudo apt install -y redis-server
sudo systemctl start redis-server
sudo systemctl enable redis-server
redis-cli ping  # 应该返回 PONG
```

#### 1.7 安装 Nginx
```bash
sudo apt install -y nginx
sudo systemctl start nginx
sudo systemctl enable nginx
```

### 第二步：数据库配置

#### 2.1 创建数据库和用户
```bash
sudo mysql -u root -p
```

在 MySQL 命令行中执行：
```sql
CREATE DATABASE oms_db CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
CREATE USER 'oms_user'@'localhost' IDENTIFIED BY 'your_secure_password';
GRANT ALL PRIVILEGES ON oms_db.* TO 'oms_user'@'localhost';
FLUSH PRIVILEGES;
EXIT;
```

#### 2.2 验证数据库连接
```bash
mysql -u oms_user -p oms_db
# 输入密码后应该能成功连接
```

### 第三步：后端部署

#### 3.1 进入后端目录
```bash
cd /home/zxy_8581/OMS/backend
```

#### 3.2 创建 Python 虚拟环境
```bash
python3 -m venv venv
source venv/bin/activate
```

#### 3.3 安装 Python 依赖
```bash
pip install --upgrade pip
pip install -r requirements.txt
```

#### 3.4 配置环境变量

如果项目中有 `.env.example` 文件，可以直接复制：
```bash
cp .env.example .env
```

如果没有 `.env.example` 文件，需要手动创建 `.env` 文件：
```bash
nano .env
```

`.env` 文件内容示例：
```
DEBUG=True
SECRET_KEY=your-secret-key-here
# 本地开发
ALLOWED_HOSTS=localhost,127.0.0.1
# 虚拟机/远程访问（需要添加服务器IP，例如：10.211.55.67）
# ALLOWED_HOSTS=localhost,127.0.0.1,10.211.55.67
DATABASE_NAME=oms_db
DATABASE_USER=oms_user
DATABASE_PASSWORD=your_secure_password
DATABASE_HOST=localhost
DATABASE_PORT=3306
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_DB=0
JWT_ACCESS_TOKEN_LIFETIME=60
JWT_REFRESH_TOKEN_LIFETIME=1440
# 本地开发
CORS_ALLOWED_ORIGINS=http://localhost:3000,http://localhost:5173
# 虚拟机/远程访问（需要添加服务器IP，例如：http://10.211.55.67:3000）
# CORS_ALLOWED_ORIGINS=http://localhost:3000,http://localhost:5173,http://10.211.55.67:3000
```

**重要提示**：
- **SECRET_KEY**：必须使用安全的随机字符串，不能随便填写。生成方法：
  ```bash
  # 方法1：使用 Python 生成
  python3 -c "from django.core.management.utils import get_random_secret_key; print(get_random_secret_key())"
  
  # 方法2：使用 openssl 生成
  openssl rand -hex 32
  
  # 方法3：使用 Python 随机字符串
  python3 -c "import secrets; print(secrets.token_urlsafe(50))"
  ```
- 将生成的 `SECRET_KEY` 替换 `.env` 文件中的 `your-secret-key-here`
- 生产环境必须将 `DEBUG` 设置为 `False`

#### 3.5 执行数据库迁移

**重要**：使用自定义用户模型时，必须先创建迁移文件，再执行迁移。

```bash
# 首先为所有应用创建迁移文件
python manage.py makemigrations

# 如果上述命令显示 "No changes detected"，可能需要为每个应用单独创建
python manage.py makemigrations accounts
python manage.py makemigrations tasks
python manage.py makemigrations workflow

# 然后执行数据库迁移
python manage.py migrate
```

> **注意**：如果遇到 "Table already exists" 错误，说明数据库中有部分表已存在但迁移记录不一致。可以使用以下命令修复：
> ```bash
> # 标记已存在的表的迁移为已应用（不实际执行SQL）
> python manage.py migrate admin --fake
> python manage.py migrate
> ```

#### 3.6 创建超级管理员
```bash
python manage.py createsuperuser
```

#### 3.7 收集静态文件
```bash
python manage.py collectstatic --noinput
```

#### 3.8 测试运行（开发环境）
```bash
# 绑定到所有网络接口，允许通过 IP 访问
python manage.py runserver 0.0.0.0:8000
```

**访问地址**：
- **本地访问**：http://localhost:8000/admin
- **虚拟机/远程访问**：http://10.211.55.67:8000/admin（将 IP 替换为你的服务器 IP）

> **注意**：使用 `0.0.0.0:8000` 而不是 `localhost:8000` 或 `127.0.0.1:8000`，这样才能通过 IP 地址访问。同时确保：
> 1. `.env` 文件中的 `ALLOWED_HOSTS` 包含服务器 IP，例如：`ALLOWED_HOSTS=localhost,127.0.0.1,10.211.55.67`
> 2. 防火墙已开放 8000 端口：`sudo ufw allow 8000`

### 第四步：前端PC端部署

#### 4.1 进入前端目录
```bash
cd /home/zxy_8581/OMS/frontend-pc
```

#### 4.2 安装依赖
```bash
npm install
```

#### 4.3 配置环境变量
```bash
cp .env.example .env.local
# 编辑 .env.local 文件，配置API地址
nano .env.local
```

`.env.local` 文件内容示例：
```
# 本地开发
VITE_API_BASE_URL=http://localhost:8000/api

# 虚拟机/远程访问（如果从外部访问前端，需要配置为服务器IP）
# VITE_API_BASE_URL=http://10.211.55.67:8000/api
```

> **注意**：
> - 如果只在虚拟机内部访问，使用 `http://localhost:8000/api`
> - 如果从外部（如宿主机）访问虚拟机上的前端，需要将 API 地址改为虚拟机 IP：`http://10.211.55.67:8000/api`

#### 4.4 构建生产版本
```bash
npm run build
```

#### 4.5 测试运行（开发环境）
```bash
npm run dev
```

**访问地址**：
- **本地访问**：http://localhost:3000
- **虚拟机/远程访问**：http://10.211.55.67:3000（将 IP 替换为你的服务器 IP）

> **注意**：如果需要在虚拟机或远程服务器上通过 IP 访问，确保：
> 1. Vite 配置文件中已设置 `host: '0.0.0.0'`（已在配置文件中默认设置）
> 2. 防火墙已开放 3000 端口：`sudo ufw allow 3000`
> 3. 后端服务也需要绑定到 `0.0.0.0:8000`，而不是 `localhost:8000`

### 第五步：微信小程序配置

#### 5.1 使用微信开发者工具
1. 打开微信开发者工具
2. 选择"导入项目"
3. 选择 `/home/zxy_8581/OMS/frontend-miniprogram` 目录
4. 配置 AppID（测试可以使用测试号）
5. 在 `utils/config.js` 中配置 API 地址

#### 5.2 配置合法域名
在微信公众平台配置服务器域名：
- request合法域名：`https://your-domain.com`
- socket合法域名：`wss://your-domain.com`

### 第六步：生产环境部署

#### 6.1 安装 Gunicorn
```bash
cd /home/zxy_8581/OMS/backend
source venv/bin/activate
pip install gunicorn
```

#### 6.2 配置 Gunicorn 服务

**重要：不同操作系统使用不同的用户**

- **Ubuntu/Debian 系统**：使用 `www-data` 用户
- **CentOS/RHEL/麒麟系统**：使用 `nginx` 用户或创建专用用户
- **其他系统**：根据实际情况选择合适的用户

创建 systemd 服务文件：
```bash
sudo nano /etc/systemd/system/oms-backend.service
```

**Ubuntu/Debian 系统服务文件内容**：
```ini
[Unit]
Description=OMS Backend Gunicorn Service
After=network.target

[Service]
Type=notify
User=www-data
Group=www-data
WorkingDirectory=/home/zxy_8581/OMS/backend
Environment="PATH=/home/zxy_8581/OMS/backend/venv/bin"
ExecStart=/home/zxy_8581/OMS/backend/venv/bin/gunicorn \
    --workers 3 \
    --bind 127.0.0.1:8000 \
    --access-logfile /var/log/oms/backend-access.log \
    --error-logfile /var/log/oms/backend-error.log \
    oms_backend.wsgi:application
Restart=always
RestartSec=3

[Install]
WantedBy=multi-user.target
```

**CentOS/RHEL/麒麟系统服务文件内容**（根据实际路径调整）：
```ini
[Unit]
Description=OMS Backend Gunicorn Service
After=network.target

[Service]
Type=notify
User=nginx
Group=nginx
WorkingDirectory=/opt/OMS/backend
Environment="PATH=/opt/OMS/backend/venv/bin"
ExecStart=/opt/OMS/backend/venv/bin/gunicorn \
    --workers 3 \
    --bind 127.0.0.1:8000 \
    --access-logfile /var/log/oms/backend-access.log \
    --error-logfile /var/log/oms/backend-error.log \
    oms_backend.wsgi:application
Restart=always
RestartSec=3

[Install]
WantedBy=multi-user.target
```

**注意事项**：
1. 将路径 `/opt/OMS/backend` 或 `/home/zxy_8581/OMS/backend` 替换为你的实际项目路径
2. 所有路径必须是绝对路径，不能使用相对路径
3. 如果系统没有 `nginx` 用户，可以创建：`sudo useradd -r -s /sbin/nologin nginx`
4. 如果遇到用户相关问题，请参考 `docs/后端服务配置问题解决方案.md`

#### 6.3 创建日志目录并设置权限

**Ubuntu/Debian 系统**：
```bash
sudo mkdir -p /var/log/oms
sudo chown www-data:www-data /var/log/oms
```

**CentOS/RHEL/麒麟系统**：
```bash
sudo mkdir -p /var/log/oms
sudo chown nginx:nginx /var/log/oms
# 如果 nginx 用户不存在，先创建：sudo useradd -r -s /sbin/nologin nginx
```

#### 6.4 启动后端服务
```bash
sudo systemctl daemon-reload
sudo systemctl start oms-backend
sudo systemctl enable oms-backend
sudo systemctl status oms-backend
```

#### 6.5 配置 Nginx

**重要：不同操作系统的 Nginx 配置方式不同**

- **Ubuntu/Debian 系统**：使用 `sites-available` 和 `sites-enabled` 目录
- **CentOS/RHEL/麒麟系统**：直接在 `conf.d` 目录创建配置文件

##### Ubuntu/Debian 系统配置方式

创建配置文件：
```bash
sudo nano /etc/nginx/sites-available/oms
```

配置文件内容（注意：根据实际路径调整）：
```nginx
# 后端API服务
upstream oms_backend {
    server 127.0.0.1:8000;
}

# 前端静态文件服务
server {
    listen 80;
    server_name _;  # 使用 _ 表示匹配所有域名，或填写具体域名/IP

    # 前端静态文件
    location / {
        root /home/zxy_8581/OMS/frontend-pc/dist;
        try_files $uri $uri/ /index.html;
    }

    # 后端API
    location /api {
        proxy_pass http://oms_backend;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # 静态文件缓存
    location /static {
        alias /home/zxy_8581/OMS/backend/staticfiles;
        expires 30d;
        add_header Cache-Control "public, immutable";
    }

    # 媒体文件
    location /media {
        alias /home/zxy_8581/OMS/backend/media;
        expires 7d;
    }
}
```

启用配置：
```bash
sudo ln -s /etc/nginx/sites-available/oms /etc/nginx/sites-enabled/
sudo nginx -t  # 测试配置
sudo systemctl reload nginx
```

##### CentOS/RHEL/麒麟系统配置方式

**说明**：
- CentOS/RHEL/麒麟系统**没有** `sites-available` 和 `sites-enabled` 目录
- 配置文件直接放在 `/etc/nginx/conf.d/` 目录
- 文件名需要以 `.conf` 结尾（如：`oms.conf`）

创建配置文件：
```bash
sudo nano /etc/nginx/conf.d/oms.conf
```

配置文件内容（注意：根据实际路径调整，如 `/opt/OMS/`）：
```nginx
# 后端API服务
upstream oms_backend {
    server 127.0.0.1:8000;
}

# 前端静态文件服务
server {
    listen 80;
    server_name _;  # 使用 _ 表示匹配所有域名，或填写具体域名/IP

    # 前端静态文件（根据实际路径调整）
    location / {
        root /opt/OMS/frontend-pc/dist;
        try_files $uri $uri/ /index.html;
    }

    # 后端API
    location /api {
        proxy_pass http://oms_backend;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # 静态文件缓存（根据实际路径调整）
    location /static {
        alias /opt/OMS/backend/staticfiles;
        expires 30d;
        add_header Cache-Control "public, immutable";
    }

    # 媒体文件（根据实际路径调整）
    location /media {
        alias /opt/OMS/backend/media;
        expires 7d;
    }
}
```

测试并重载配置：
```bash
sudo nginx -t  # 测试配置语法
sudo systemctl reload nginx  # 重载配置
```

**重要：禁用默认配置**

为了避免显示 Nginx 欢迎页面，需要禁用或删除默认配置文件：

```bash
# CentOS/RHEL/麒麟系统：重命名或删除默认配置
sudo mv /etc/nginx/conf.d/default.conf /etc/nginx/conf.d/default.conf.bak
# 或者直接删除：sudo rm /etc/nginx/conf.d/default.conf

# Ubuntu/Debian 系统：删除默认配置的符号链接
sudo rm /etc/nginx/sites-enabled/default

# 然后重新测试和重载
sudo nginx -t
sudo systemctl reload nginx
```

**关于 `server_name` 的配置说明**：
- `server_name _;` - 匹配所有域名（适用于没有域名或使用 IP 访问的情况）
- `server_name 192.168.1.100;` - 使用服务器 IP 地址
- `server_name oms.example.com;` - 使用具体域名（如果有域名）
- `server_name localhost;` - 仅本地访问

**推荐配置**：
- 如果只有 IP 地址访问：使用 `server_name _;`
- 如果有域名：使用 `server_name your-domain.com;`
- 如果有多个域名：使用 `server_name domain1.com domain2.com;`

**注意事项**：
1. 配置文件路径必须根据实际部署路径调整（如 `/opt/OMS/` 或 `/home/zxy_8581/OMS/`）
2. 确保前端静态文件目录存在且有读取权限
3. 确保后端静态文件和媒体文件目录存在且有读取权限
4. 如果修改了配置文件，必须运行 `sudo nginx -t` 测试配置，无误后再重载

#### 6.6 配置 HTTPS（可选但推荐）

**Ubuntu/Debian 系统**：
```bash
sudo apt install -y certbot python3-certbot-nginx
sudo certbot --nginx -d your-domain.com
```

**CentOS/RHEL/麒麟系统**：
```bash
# 安装 EPEL 仓库（如果未安装）
sudo yum install -y epel-release

# 安装 certbot
sudo yum install -y certbot python3-certbot-nginx

# 配置 SSL（将 your-domain.com 替换为你的域名）
sudo certbot --nginx -d your-domain.com
```

**注意**：HTTPS 配置需要：
1. 拥有一个域名并正确配置 DNS 指向服务器 IP
2. 服务器 80 和 443 端口对外开放
3. 如果没有域名，可以暂时跳过 HTTPS 配置，使用 HTTP 访问

### 第七步：验证部署

#### 7.1 检查服务状态
```bash
# 检查后端服务
sudo systemctl status oms-backend

# 检查 Nginx
sudo systemctl status nginx

# 检查 Redis
sudo systemctl status redis-server

# 检查 MySQL
sudo systemctl status mysql
```

#### 7.2 测试API

**通过 Nginx 代理访问（推荐）**：
```bash
# 假设服务器 IP 是 172.29.91.61
curl http://172.29.91.61/api/
```

**直接访问后端（仅服务器本地）**：
```bash
curl http://localhost:8000/api/
```

#### 7.3 访问前端

**生产环境访问地址**（假设服务器 IP 是 `172.29.91.61`）：

- **前端页面**：`http://172.29.91.61`
  - 通过 Nginx 访问前端静态文件
  - 如果配置了域名，使用域名访问：`http://your-domain.com`

- **后端 API**：`http://172.29.91.61/api`
  - 所有 API 请求通过 `/api` 路径访问
  - 由 Nginx 代理到后端服务（127.0.0.1:8000）

- **后端静态文件**：`http://172.29.91.61/static/...`
  - Django 收集的静态文件

- **媒体文件**：`http://172.29.91.61/media/...`
  - 上传的附件等媒体文件

**开发环境访问地址**：
- 前端：http://localhost:3000
- 后端：http://localhost:8000/api

**访问地址总结**：

| 服务类型 | 生产环境地址 | 说明 |
|---------|------------|------|
| 前端页面 | `http://172.29.91.61` | 通过 Nginx 访问 |
| 后端 API | `http://172.29.91.61/api` | 通过 Nginx 代理 |
| 后端直接访问 | `http://127.0.0.1:8000` | 仅服务器本地访问 |

**注意事项**：
1. 确保已禁用 Nginx 默认配置，否则可能显示欢迎页面
2. 确保后端服务的 `.env` 文件中 `ALLOWED_HOSTS` 包含服务器 IP
3. 确保前端构建时已配置正确的 API 地址
4. 如果访问时显示 502 错误，检查后端服务是否正常运行

### 第八步：短信功能配置

#### 8.1 安装依赖
短信功能需要 `requests` 库，确保已安装：
```bash
cd /home/zxy_8581/OMS/backend
source venv/bin/activate
pip install requests==2.31.0
```

#### 8.2 运行数据库迁移
短信功能新增了三个数据表，需要运行迁移：
```bash
cd /home/zxy_8581/OMS/backend
source venv/bin/activate
python manage.py migrate workflow
```

#### 8.3 配置短信接口
登录后台管理系统（http://your-domain.com/admin），进入 **短信配置** 模块：

1. **创建短信配置**
   - 配置名称：可自定义，如 "default"
   - 短信接口地址：填写短信服务提供商提供的接口URL
   - 接口参数模板：JSON格式，支持占位符
     - `{phone}`：接收短信的手机号
     - `{content}`：短信内容
     - 示例：
       ```json
       {
         "mobile": "{phone}",
         "message": "{content}",
         "appid": "your_app_id",
         "appkey": "your_app_key"
       }
       ```
   - 是否启用：勾选后才会发送短信

2. **配置短信模板**
   系统提供了6种短信模板类型，需要为每种类型配置模板内容：
   
   - **任务提交**（task_submitted）
     - 默认内容：`您有一条待审核任务，任务名称为{任务标题}，请尽快登陆运维管理系统进行审核。`
   
   - **任务审核通过**（task_reviewed）
     - 默认内容：`您有一条待分配任务，任务名称为{任务标题}，请尽快登陆运维管理系统进行分配。`
   
   - **任务审核不通过**（task_reviewed_rejected）
     - 默认内容：`您发起的任务未审核通过，原因为{审核不通过的理由}`
   
   - **任务分配**（task_assigned）
     - 默认内容：`您有一条待处理任务，任务名称为{任务标题}，请尽快登陆运维管理系统进行处理。`
   
   - **任务完成**（task_completed）
     - 默认内容：`您发起的任务已完成，请登陆运维管理系统进行确认，任务名称为{任务标题}。`
   
   - **任务需要修改**（task_needs_modification）
     - 默认内容：`您处理的任务需要修改，任务名称为{任务标题}，修改意见：{修改意见}，请尽快登陆运维管理系统进行修改。`

3. **查看短信发送记录**
   - 在后台的 **短信发送记录** 模块可以查看所有短信的发送情况
   - 包括发送状态（待发送/发送成功/发送失败）、接收人、发送时间等信息
   - 如果发送失败，可以查看错误信息进行排查

#### 8.4 配置用户手机号
确保需要接收短信的用户在系统中设置了手机号：
- 登录后台管理系统，进入 **用户** 模块
- 编辑用户信息，填写 **手机号** 字段
- 只有设置了手机号的用户才能接收到短信

#### 8.5 短信发送规则
系统会在以下场景自动发送短信：

1. **任务提交时**：使用方提交任务后，自动发送给所有管理方用户
2. **任务审核通过时**：管理方审核通过后，自动发送给所有项目经理
3. **任务审核不通过时**：管理方审核不通过时，自动发送给任务创建者
4. **任务分配时**：项目经理分配任务后，自动发送给被分配的员工
5. **任务完成时**：员工完成任务后，自动发送给任务创建者
6. **任务需要修改时**：使用方标记任务完成但提出需要修改时，自动发送给处理员工

#### 8.6 注意事项
1. **短信接口配置**：
   - 接口地址和参数需要根据实际使用的短信服务商文档进行配置
   - 参考文档位于 `/docs/审批短信接口（新）.docx`
   - 确保接口参数模板格式正确，否则可能导致发送失败

2. **短信模板配置**：
   - 模板内容支持占位符，如 `{任务标题}`、`{审核不通过的理由}` 等
   - 系统会自动将占位符替换为实际值

3. **发送失败处理**：
   - 如果短信发送失败，系统会记录错误信息
   - 可以在后台的 **短信发送记录** 中查看失败原因
   - 常见原因：接口地址错误、参数格式错误、手机号格式错误等

4. **权限要求**：
   - 只有管理员可以在后台配置短信接口和模板
   - 所有用户都可以查看自己的短信发送记录

5. **启用/禁用**：
   - 可以通过禁用短信配置或模板来临时关闭短信功能
   - 禁用后，相关操作不会触发短信发送，但其他功能正常

## 常见问题

### 1. 数据库连接失败
- 检查 `.env` 文件中的数据库配置
- 确认 MySQL 服务正在运行
- 验证数据库用户权限

### 2. 前端无法连接后端
- 检查 `.env.local` 中的 API 地址配置
- 确认后端服务正在运行
- 检查 CORS 配置

### 3. 静态文件404
- 运行 `python manage.py collectstatic`
- 检查 Nginx 配置中的静态文件路径

### 4. 权限问题
- 确保文件所有者正确：`sudo chown -R www-data:www-data /home/zxy_8581/OMS`
- 检查目录权限：`chmod -R 755 /home/zxy_8581/OMS`

## 维护命令

### 重启服务
```bash
# 重启后端
sudo systemctl restart oms-backend

# 重启 Nginx
sudo systemctl restart nginx
```

### 查看日志
```bash
# 后端日志
sudo journalctl -u oms-backend -f

# Nginx 日志
sudo tail -f /var/log/nginx/access.log
sudo tail -f /var/log/nginx/error.log
```

### 更新代码
```bash
# 拉取最新代码
cd /home/zxy_8581/OMS
git pull

# 更新后端依赖
cd backend
source venv/bin/activate
pip install -r requirements.txt
# 特别注意：如果新增了短信功能，确保已安装 requests 库
pip install requests==2.31.0
python manage.py migrate
python manage.py collectstatic --noinput
sudo systemctl restart oms-backend

# 更新前端
cd ../frontend-pc
npm install
npm run build
sudo systemctl reload nginx
```

## 安全建议

1. **修改默认密码**：所有默认密码必须修改
2. **使用HTTPS**：生产环境必须启用HTTPS
3. **防火墙配置**：只开放必要端口（80, 443, 22）
4. **定期备份**：定期备份数据库和重要文件
5. **更新系统**：定期更新系统和依赖包
6. **监控日志**：定期检查系统日志，发现异常及时处理

## 备份与恢复

### 数据库备份
```bash
mysqldump -u oms_user -p oms_db > backup_$(date +%Y%m%d).sql
```

### 数据库恢复
```bash
mysql -u oms_user -p oms_db < backup_20240101.sql
```

### 文件备份
```bash
tar -czf oms_backup_$(date +%Y%m%d).tar.gz /home/zxy_8581/OMS
```

